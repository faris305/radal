const fs = require('fs-extra');
const path = require('path');
const { getStartTime, updateStartTime } = require('./utils');

// Path folder yang ingin Anda kunci setelah 30 hari
const folderPath = '/..Radar Clear';

// Fungsi untuk mengunci folder setelah 30 hari
const lockFolderAfter30Days = (folderPath) => {
  try {
    const stats = fs.statSync(folderPath);
    const { birthtime } = stats; // Tanggal folder dibuat

    // Dapatkan tanggal awal dari file
    const startDate = getStartTime();
    const thirtyDaysAgo = new Date(startDate);
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() + 30); // Tanggal 30 hari yang lalu

    // Bandingkan tanggal pembuatan folder dengan tanggal 30 hari yang lalu
    if (birthtime < thirtyDaysAgo) {
      // Ubah izin folder menjadi hanya bisa dibaca (0444)
      fs.chmodSync(folderPath, 0o444);
      console.log(`Folder ${folderPath} telah dikunci.`);
    } else {
      console.log(`Folder ${folderPath} belum mencapai 30 hari.`);
    }
  } catch (err) {
    console.error(`Error: ${err.message}`);
  }
};

// Panggil fungsi untuk mengunci folder
lockFolderAfter30Days(folderPath);
